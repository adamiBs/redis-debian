#!/bin/bash

sed -i 's/^daemonize no/daemonize yes/' redis.conf
sed -i 's/^# supervised auto/supervised auto/' redis.conf
sed -i 's#^pidfile .*$#pidfile /run/redis/redis-server.pid#' redis.conf
sed -i 's#^logfile .*$#logfile /var/log/redis/redis-server.log#' redis.conf
sed -i 's#^dir .*$#dir /var/lib/redis#' redis.conf

sed -i 's/^# bind .*$/bind 127.0.0.1 ::1/' sentinel.conf
sed -i 's/^daemonize no/daemonize yes/' sentinel.conf
sed -i 's#^pidfile .*$#pidfile /run/redis/redis-sentinel.pid#' sentinel.conf
sed -i 's#^logfile .*$#logfile /var/log/redis/redis-sentinel.log#' sentinel.conf
sed -i 's#^dir .*$#dir /var/lib/redis#' sentinel.conf

# TODO: Add this as a default line so we can modify it.
grep -q '^supervised' sentinel.conf || echo "supervised auto" >> sentinel.conf

grep -q '^# Modules' redis.conf || (
cat >> redis.conf <<_END_

# Modules
loadmodule /usr/lib/redis/modules/rejson.so
loadmodule /usr/lib/redis/modules/redisbloom.so
loadmodule /usr/lib/redis/modules/redistimeseries.so
loadmodule /usr/lib/redis/modules/redisearch.so
_END_
)
